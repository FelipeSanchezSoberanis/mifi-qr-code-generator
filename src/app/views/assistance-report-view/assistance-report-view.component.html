<main class="container">
  <h1 class="text-center mb-3">Generar reporte de asistencias</h1>

  <div
    *ngFor="let session of sessions.controls; index as i"
    class="row justify-content-center mb-3"
  >
    <div class="col-auto">
      <label class="col-form-label">Sesión</label>
    </div>
    <div class="col-auto">
      <input
        (change)="handleSessionChanged()"
        [formControl]="session"
        class="form-control"
        type="date"
      />
    </div>
    <div class="col-auto">
      <button (click)="deleteSession(i)" class="btn btn-danger">x</button>
    </div>
  </div>

  <div class="row justify-content-center mb-3">
    <div class="col-auto">
      <button (click)="addSession()" class="btn btn-primary">Agregar sesión</button>
    </div>
  </div>

  <div class="row justify-content-center mb-3">
    <div class="col-auto">
      <input
        [disabled]="!sessions.valid || sessions.controls.length <= 0"
        class="form-control"
        type="file"
        accept=".csv"
        multiple
        (change)="handleRegistrationFilesUploaded($event)"
      />
    </div>
  </div>

  <hr *ngIf="assistanceReport" />

  <h2 class="text-center mb-3" *ngIf="assistanceReport">Reporte de asistencias</h2>

  <table class="table table-striped" *ngIf="assistanceReport">
    <thead>
      <tr>
        <th>Estudiante</th>
        <th class="text-center" *ngFor="let session of sessions.value">{{ session }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let assistanceRecord of assistanceReport | keyvalue">
        <td>{{ getStudentNameFromEnrollmentId(assistanceRecord.key) }}</td>
        <td
          *ngFor="let session of sessions.value"
          class="text-center fw-bold"
          [ngClass]="assistanceRecord.value[session!] ? 'text-success' : 'text-danger'"
        >
          {{ assistanceRecord.value[session!] ? "Sí" : "No" }}
        </td>
      </tr>
    </tbody>
  </table>
</main>
